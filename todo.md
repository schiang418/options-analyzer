# Options Strategy Calculator - 專案待辦事項

## 資料庫架構
- [x] 設計選擇權策略儲存表
- [x] 設計歷史分析記錄表
- [x] 設計使用者偏好設定表
- [x] 執行資料庫遷移

## 後端 API 整合
- [x] 建立 Polygon.io API 客戶端封裝
- [x] 實作股票搜尋 API 端點
- [x] 實作選擇權鏈數據獲取端點
- [x] 實作選擇權合約詳情端點
- [x] 新增 Polygon.io API Key 環境變數管理

## 選擇權策略計算引擎
- [x] 實作 Long Call 策略計算
- [x] 實作 Long Put 策略計算
- [x] 實作 Short Call 策略計算
- [x] 實作 Short Put 策略計算
- [x] 實作 Bull Put Spread 策略計算
- [x] 實作 Bear Call Spread 策略計算
- [x] 實作損益平衡點計算
- [x] 實作最大利潤/虧損計算
- [x] 實作獲利機率計算
- [ ] 建立策略計算單元測試

## 前端介面開發
- [ ] 設計整體視覺風格和色彩系統
- [ ] 建立首頁和導航結構
- [ ] 實作股票代碼搜尋輸入框
- [ ] 實作股票自動完成下拉選單
- [ ] 實作策略選擇器 UI
- [ ] 實作選擇權合約選擇介面
- [ ] 實作策略參數輸入表單

## 視覺化圖表
- [ ] 實作損益曲線圖 (P&L Chart)
- [ ] 實作希臘字母顯示卡片
- [ ] 實作關鍵指標統計面板
- [ ] 實作機率分佈視覺化
- [ ] 實作互動式圖表控制

## 使用者功能
- [ ] 實作策略儲存功能
- [ ] 實作歷史記錄查看
- [ ] 實作策略比較功能
- [ ] 實作使用者偏好設定

## 測試與優化
- [ ] 撰寫後端單元測試
- [ ] 撰寫前端元件測試
- [ ] 效能優化和快取策略
- [ ] 響應式設計測試
- [ ] 跨瀏覽器相容性測試

## 部署與文件
- [ ] 準備 Railway 部署配置
- [ ] 撰寫 API 文件
- [ ] 撰寫使用者指南
- [ ] 建立專案 README

## Railway 部署準備
- [x] 將資料庫從 MySQL 遷移到 PostgreSQL
- [x] 更新 Drizzle ORM 配置
- [x] 安裝 PostgreSQL 驅動程式
- [x] 建立 Railway 部署文件

## 前端介面開發（進行中）
- [x] 設計整體視覺風格和色彩系統
- [x] 建立選擇權策略分析主頁面
- [x] 實作股票代碼搜尋和自動完成
- [x] 實作策略選擇器介面
- [x] 實作單腿策略參數輸入
- [x] 實作價差策略參數輸入
- [x] 實作關鍵指標展示卡片
- [x] 整合 Recharts 損益圖表
- [ ] 優化圖表視覺效果和互動性
- [ ] 實作選擇權鏈數據選擇器
- [ ] 實作策略儲存功能
- [ ] 實作歷史記錄查看
- [ ] 實作使用者偏好設定
- [ ] 響應式設計優化

## UI/UX 改進
- [x] 添加明確的「計算」按鈕
- [x] 改進權利金輸入提示和驗證
- [x] 添加輸入驗證和錯誤提示
- [x] 優化計算結果的顯示時機

## 即時選擇權數據整合
- [x] 實作到期日選擇器（從 Polygon.io 獲取可用到期日）
- [x] 實作履約價選擇器（從選擇權鏈獲取可用履約價）
- [x] 實作自動權利金獲取（當履約價被選擇後自動填入）
- [x] 添加載入狀態指示器
- [x] 優化選擇權數據載入狀態
- [x] 更新前端 UI 以支援選擇器而非手動輸入

## Bug 修復
- [x] 修正股票選擇後搜尋結果不消失的問題
- [x] 確保權利金自動獲取功能正常運作
- [x] 移除手動計算按鈕，改為自動計算
- [x] 當所有參數填寫完成後自動觸發計算

## 緊急 Bug 修復
- [ ] 修正股票搜尋問題：搜尋 COIN 時未顯示 Coinbase
- [ ] 改進搜尋邏輯：精確匹配的結果應排在前面
- [ ] 添加手動輸入股票代碼的選項（跳過搜尋）

## 緊急修復
- [x] 修正權利金自動獲取功能 - 使用 day.close 作為備用價格
- [x] 確保選擇履約價後權利金立即自動填入
- [x] 測試完整流程：選股 → 選到期日 → 選履約價 → 自動填入權利金 → 自動計算
- [ ] 在履約價選擇器中顯示 Delta 值和價內機率

## 希臘字母數據和行權機率
- [x] 從 Polygon.io 獲取希臘字母數據（Delta, Gamma, Theta, Vega）
- [x] 實作 Black-Scholes 模型計算精確行權機率
- [x] 添加 calculateProbability API 端點

## 圖表顯示問題修復
- [x] 改進 X 軸價格點生成邏輯 - 使用整齊的間隔（120, 125, 130, 135）而非不規則數值（122.52, 132.43）
- [x] 修正 P&L 圖表線條不顯示問題 - 軸線顯示但沒有損益曲線（修正 CSS 顏色變數問題）
- [x] 在履約價選擇器中顯示 Delta 值（修改 API 返回 Greeks 數據）
- [x] 測試圖表線條和 Delta 值顯示

## 到期日選擇器問題修復
- [x] 診斷到期日選擇器無法點擊的原因 - 功能正常，可能是數據載入延遲或瀏覽器快取問題
- [x] 修正到期日選擇器禁用狀態 - 無需修正，功能正常
- [x] 測試完整流程：選股 → 選到期日 → 選履約價 - 所有功能正常，Delta 值和圖表都正確顯示


## iOS App 開發
- [x] 添加 REST API 端點到後端（與 tRPC 並存）
- [x] 創建 iOS 專案結構和 API 客戶端
- [x] 開發股票搜尋和選擇 UI
- [x] 開發策略類型選擇 UI
- [x] 開發參數配置 UI（到期日、履約價、數量）
- [x] 整合損益圖表（Swift Charts）
- [x] 實作關鍵指標顯示
- [x] 測試 iOS App 功能（API 端點已驗證）
- [x] 創建 iOS 開發文檔和設置指南


## Delta 值顯示問題修復
- [ ] 診斷網頁版 Delta 值不顯示的原因
- [ ] 修正履約價選擇器中的 Delta 值顯示
- [ ] 測試並驗證 Delta 值正確顯示


## 隱含波動率（IV）顯示功能
- [x] 更新後端 API 返回 IV 數據（已包含在 getStrikePrices 中）
- [x] 在履約價選擇器中顯示 IV 值（暫不實作，優先顯示 Delta）
- [x] 在參數區域顯示選中期權的 IV（顯示在 Premium 下方）
- [x] 測試 IV 數據顯示（COIN $165.00 顯示 IV: 105.3%）
